function getBasePath() {
    const manifestHref = document
        .querySelector('link[rel="manifest"]')
        ?.getAttribute("href");

    if (!manifestHref) {
        return "/";
    }

    const manifestUrl = new URL(manifestHref, window.location.href);
    const match = manifestUrl.pathname.match(/^(.*)assets\/manifest\.webmanifest$/);

    if (match && match[1]) {
        const path = match[1];
        return path.endsWith("/") ? path : `${path}/`;
    }

    return "/";
}

if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
        const basePath = getBasePath();
        const scope = basePath || "/";
        const swUrl = `${basePath}assets/service-worker.js`;

        navigator.serviceWorker
            .register(swUrl, { scope })
            .catch((err) => console.error("SW registration failed", err));
    });
}
